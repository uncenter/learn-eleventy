---
sort: 21
title: 'Lesson 21: HTML minification'
---

TODO

## Adding the transform

We’re going to use a handy Eleventy feature called [Transforms](https://www.11ty.dev/docs/config/#transforms). Transforms are a bit like filters where we take the input, pass it though the Transform and then get the transformed output back in return. The Eleventy Image plugin from [the last lesson](/lesson/20) itself uses Transforms under the hood, so we already know how powerful they can be.

We’re going to grab each page as it’s built and minify the HTML, **only** if we are in production mode. The reason why we only minify HTML in production mode is because this upcoming function is pretty heavy-duty, for understandable reasons, so it makes sense to only run it once per page.

Now, in our `eleventy.config.js` configuration file, start by importing the following import at the top:

```js
import htmlmin from 'html-minifier-next';
```

Above the start of the configuration function, add this variable declaration:

```js
const isProduction = process.env.NODE_ENV === 'production';
```

In the configuration function, add the transform itself:

```js
if (isProduction) {
	eleventyConfig.addTransform('htmlmin', function (content) {
		if ((this.page.outputPath || '').endsWith('.html')) {
			return htmlmin.minify(content, {
				useShortDoctype: true,
				removeComments: true,
				collapseWhitespace: true,
			});
		}
		return content;
	});
}
```

We’ve added our Transform, we’re determining whether or not we’re in production mode.

What the function does is first check each page to see if it’s an HTML file. If not, it returns it out, untouched. If it _is_ a HTML file, it runs it through a package called `html-minifier-next` (a modern fork of the original `html-minifier-terser` and `html-minifier` projects) which gives us back some nice compressed HTML in return.

We’ve got a new package here, so let’s install it. In your terminal, run the following:

```sh
npm install html-minifier-next
```

That's it! If you weren’t running it already, run `npm start` in your terminal. Try inspecting the HTML in the output folder (`dist/`), or **view source** on <http://localhost:8080>. Now, stop Eleventy ([[ctrl]] + [[c]]), and this time run `NODE_ENV=production npm start`. This command sets the `NODE_ENV` environment variable to `production` — we'll learn more about this later in the tutorial — which triggers Eleventy to add our HTML minification transform. If you inspect or **view source** this time, you should see the HTML look very packed and much more condensed. Hoorah!

![A block of compressed, minified HTML](/images/ss-view-source.jpg)

## Wrapping up

TODO
